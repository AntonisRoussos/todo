<style type="text/css">
        .row-highlight {background-color: Yellow;}
	.row-white {background-color: white;}
td.desc {width:50%;}
td.due {width:20%;}
td.prior {width:10%;}
	.active-row
</style>

<%= javascript_include_tag 'tasklistview' %>  

<script type="text/javascript">

$('#tab-container').tabs({spinner: 'Retrieving data...' });

$(".pagination a").click(function (event) {
    		 event.preventDefault();
		 var id = $(this).attr('href');
		 $('#task_information').empty().load(id);
       		 $('#task-details').empty();
});

//$("#tbl").delegate('click', '.edit a', c=function(event){
$(".edit a").bind('click', c=function (event) {
//$(".edit a").click(c=function (event) {
		event.preventDefault();
		var oldDesc;
		var olddDue;
		var oldPriority;
                 var tr = $('#tbl').find('tr');
		 tr.unbind('mouseenter').unbind('mouseleave');
	//	 tr.removeClass('row-highlight');
	//		 if bluerow == true {tr.addClass('gridtable');}	
		 $(".edit a").unbind('click');


                     var tds = $('tr.active-row').find(' td');

                     $.each(tds, function(index, item) {
	 			if (index==2) {oldDescription = item.innerHTML;}
  				if (index==1) {oldDue = item.innerHTML;}
  				if (index==4) {oldPriority = item.innerHTML;}
                     });


		 var href = $(this).attr('href');
		 var i1 = href.indexOf("tasks");
		 var i1 = i1 + 6;
		 var i2 = href.indexOf("edit");
		 var i2 = i2 - 1;
		 var taskid = href.slice(i1, i2);
		 var values = ''; 
		  values = values + '<form accept-charset="UTF-8" action="/tasks/update" class="task_edit" data-remote="true" id="edit_task" method="post">';
		  values = values + '<input id="task_id" name="task[id]" value=' + taskid + ' type="hidden" />';
		  values = values + I18n.t("javascripts.Description");  
		  values = values + '<input id="task_description" maxlength="30" name="task[description]" size="30" type="text" value ="' + oldDescription + '" />' + '<br/>';
		  values = values + I18n.t("javascripts.Due"); 
		  values = values + '<input id="task_due" maxlength="19" name="task[due]" size="19" type="text" value ="' + oldDue + '" />' + '<br/>';
		  values = values + I18n.t("javascripts.Priority"); 
		  values = values + '<input id="task_priority" maxlength="1" name="task[priority]" size="1" type="text" value ="' + oldPriority + '" />' + '<br/>';
   		  values = values + '<input id="task_submit" name="commit" type="submit" value="Update" />';
		  values = values + '</form>';
		  $('#task-details').empty().html(values);
	  	  //	 $("#tbl").undelegate('click', '.edit a', c);
//                 var id = $(this).attr('href');
	//		 $('#task-details').empty().load(id, function()
	//                 {$('#description').focus();});
	//	 $('#task-details').empty().load(id);
});

$("#task-details").submit({desc: '#edit_task #task_description', due: '#edit_task #task_due', prior: '#edit_task #task_priority'}, function(event) {

	         event.preventDefault();
                 var tr = $('#tbl').find('tr');


$.ajax({
  	url: "/tasks/retrieve_day",
  	type: "GET",
  	data: {date : $(event.data.due).attr('value')},
  	dataType: "xml",
    	async: false,
	success:function(rdata) {
	$(rdata).find("Response").each(function()
		{$('tr.active-row td').filter('#due').replaceWith('<td CLASS="due" id="due">'+$(this).find("Date").text()+'</td>');});
	}
});

		alert($(event.data.desc).attr('value'));
		 $('tr.active-row td').filter('#desc').replaceWith('<td CLASS="desc" id="desc">'+$(event.data.desc).attr('value')+'</td>');
//		 $('tr.active-row td').filter('#due').replaceWith('<td>'+$(event.data.due).attr('value')+'</td>');
		 $('tr.active-row td').filter('#prior').replaceWith('<td CLASS="prior" id="prior">'+$(event.data.prior).attr('value')+'</td>');
		 tr.bind('mouseenter', a).bind('mouseleave', b);
		 $(".edit a").bind('click', c);
	//	 $("#tbl").delegate('click', '.edit a', c);
	 	 //		 bluerow = $('tr.active-row').hasClass("gridtable")
	//	 $("tr:even").css("background-color", "#e5ecf9");
	//	 tr.removeClass('active-row');
		 tr.removeClass('row-highlight');
        //         $("#tbl tr:nth-of-type(even)").addClass('gridtable');
   		 tr.addClass('gridtable');
     		 $('#task-details').empty();
});


$(document).ready(function() {
	//		$( "#tab-container" ).bind( "tabsselect", function() {
			$('#task-details').empty().load(id);
})



$(".destroy a").bind('click', c=function (event) {

                 var tr = $('#tbl').find('tr');
		 tr.bind('mouseenter', a).bind('mouseleave', b);
		 $(".edit a").bind('click', c);
		 tr.removeClass('row-highlight');
   		 tr.addClass('gridtable');
     		 $('#task-details').empty();

});


</script>

<table id="tbl">
<col style="{visibility: collapse;}" />
<col style="{visibility: collapse;}" />
<col />
<col />
<col />
<col />
<col />
<% @tasks.each do |task| %>
    <tr CLASS="gridtable">
      <td CLASS="id" ><%= task.id %></td>
      <td CLASS="originaldue" ><%= task.due.to_s[0,10] %></td>
      <td CLASS="desc" id="desc"><%= task.description %></td>
      <td CLASS="due" id="due"><%= @day[task.due.wday] + " " + task.due.strftime("%d") %></td>
      <td CLASS="prior" id="prior"><%= task.priority %></td>
      <td CLASS="prior edit"><%= link_to t(:Edit), edit_task_path(task), :remote => true %><!-- %= link_to t(:Edit), edit_task_path(task) % --></td>
      <td CLASS="prior destroy"><%= link_to t(:Destroy), task, :confirm => t(:Are_you_sure?), :method => :delete %></td>
   </tr>
  <% end %>
</table>

<%= will_paginate @tasks %>

 <!-- %= will_paginate @tasks, :renderer => RemoteLinkRenderer % -->



